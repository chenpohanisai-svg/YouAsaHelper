<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO åŸºæœ¬è³‡è¨Š -->
    <title>éº»é†‰é¢¨éšªè©•ä¼°åŠ©æ‰‹ | è¡“å‰å®‰å…¨è©•ä¼°å·¥å…·</title>
    <meta name="description" content="é€™æ˜¯ä¸€å€‹å…è²»çš„ç·šä¸Šéº»é†‰é¢¨éšªè©•ä¼°å·¥å…·ï¼Œå¹«åŠ©ç—…äººèˆ‡é†«ç™‚äººå“¡å¿«é€Ÿäº†è§£è¡“å‰é¢¨éšªèˆ‡å»ºè­°ï¼Œæå‡æ‰‹è¡“å®‰å…¨ã€‚">
    
    <!-- Open Graph for Facebook / LINE / LinkedIn -->
    <meta property="og:title" content="éº»é†‰é¢¨éšªè©•ä¼°åŠ©æ‰‹ | è¡“å‰å®‰å…¨è©•ä¼°å·¥å…·">
    <meta property="og:description" content="å…è²»ç·šä¸Šéº»é†‰é¢¨éšªè©•ä¼°å·¥å…·ï¼Œå¹«åŠ©ç—…äººèˆ‡é†«ç™‚äººå“¡å¿«é€Ÿäº†è§£è¡“å‰é¢¨éšªèˆ‡å»ºè­°ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://anesthesia-risk-assessment.vercel.app/">
    <meta property="og:image" content="https://anesthesia-risk-assessment.vercel.app/preview.png">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "MedicalRiskCalculator",
      "name": "éº»é†‰é¢¨éšªè©•ä¼°åŠ©æ‰‹",
      "description": "å…è²»ç·šä¸Šéº»é†‰é¢¨éšªè©•ä¼°å·¥å…·ï¼Œå¹«åŠ©ç—…äººèˆ‡é†«ç™‚äººå“¡å¿«é€Ÿäº†è§£è¡“å‰é¢¨éšªèˆ‡å»ºè­°ã€‚",
      "url": "https://anesthesia-risk-assessment.vercel.app/",
      "publisher": {
        "@type": "Organization",
        "name": "Anesthesia Helper"
      }
    }
    </script>
    
    <!-- è¼‰å…¥ä¾è³´åº« -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Noto Sans TC', sans-serif;
      }
      
      /* åˆ—å°æ¨£å¼å„ªåŒ– */
      @media print {
        body, html { 
          background-color: white !important; 
          -webkit-print-color-adjust: exact;
          color-adjust: exact;
        }
        body * { visibility: hidden; }
        .print-container, .print-container * { visibility: visible; }
        .print-container { 
          position: absolute; 
          left: 0; 
          top: 0; 
          width: 100%; 
          padding: 2rem; 
        }
        .no-print { display: none !important; }
        .page-break { page-break-before: always; }
      }
      
      /* ç„¦é»æ¨£å¼å¢å¼· */
      .focus-enhanced:focus {
        outline: 2px solid #dc2626;
        outline-offset: 2px;
      }
      
      /* å‹•ç•«æ•ˆæœ */
      .slide-in {
        animation: slideIn 0.3s ease-out;
      }
      
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
    </style>
</head>
<body class="bg-stone-50">
    <div id="root"></div>
    
    <script type="text/babel">
      const { useState, useMemo, useCallback, useRef, useEffect } = React;
      
      // === å¸¸æ•¸å®šç¾© ===
      const CONSTANTS = {
        TOTAL_STEPS: 4,
        BMI: {
          UNDERWEIGHT: 18.5,
          NORMAL: 25,
          OVERWEIGHT: 30,
          OBESE: 40
        },
        AGE: {
          MIN: 1,
          MAX: 120,
          ELDERLY: 50
        },
        PHYSICAL: {
          HEIGHT_MIN: 50,
          HEIGHT_MAX: 250,
          WEIGHT_MIN: 10,
          WEIGHT_MAX: 500
        },
        SCORES: {
          STOP_BANG_HIGH_RISK: 3,
          STOP_BANG_VERY_HIGH_RISK: 5,
          CARDIAC_HIGH_RISK: 2
        }
      };
      
      const RISK_LEVELS = {
        HIGH: 'high',
        MEDIUM: 'medium',
        LOW: 'low',
      };
      
      const RISK_COLORS = {
        [RISK_LEVELS.LOW]: 'bg-emerald-100 text-emerald-800 border-emerald-400',
        [RISK_LEVELS.MEDIUM]: 'bg-orange-100 text-orange-800 border-orange-400',
        [RISK_LEVELS.HIGH]: 'bg-red-100 text-red-800 border-red-400',
      };
      
      const RISK_TEXT = {
        [RISK_LEVELS.LOW]: 'è¼ƒä½',
        [RISK_LEVELS.MEDIUM]: 'ä¸­åº¦',
        [RISK_LEVELS.HIGH]: 'è¼ƒé«˜'
      };
      
      const ASA_DESCRIPTIONS = {
        1: 'ASA 1: å¥åº·çš„æ­£å¸¸äººã€‚',
        2: 'ASA 2: æœ‰è¼•åº¦å…¨èº«æ€§ç–¾ç—…ï¼Œä½†ç„¡åŠŸèƒ½éšœç¤™ã€‚',
        3: 'ASA 3: æœ‰ä¸­åº¦è‡³é‡åº¦çš„å…¨èº«æ€§ç–¾ç—…ä¸”é€ æˆåŠŸèƒ½éšœç¤™ã€‚',
        4: 'ASA 4: æœ‰é‡åº¦çš„å…¨èº«æ€§ç–¾ç—…ï¼Œå°ç”Ÿå‘½é€ æˆéš¨æ™‚çš„å¨è„…ã€‚',
      };
      
      // === å·¥å…·å‡½å¼ ===
      const calculateBMI = (height, weight) => {
        if (!height || !weight || height <= 0 || weight <= 0) return null;
        const heightInMeters = height / 100;
        return (weight / (heightInMeters * heightInMeters)).toFixed(1);
      };
      
      const validateStep1 = (formData) => {
        const age = parseInt(formData.age);
        const height = parseInt(formData.height);
        const weight = parseInt(formData.weight);
        
        const errors = {};
        
        if (!formData.age || isNaN(age) || age < CONSTANTS.AGE.MIN || age > CONSTANTS.AGE.MAX) {
          errors.age = `å¹´é½¡å¿…é ˆåœ¨ ${CONSTANTS.AGE.MIN}-${CONSTANTS.AGE.MAX} æ­²ä¹‹é–“`;
        }
        
        if (!formData.height || isNaN(height) || height < CONSTANTS.PHYSICAL.HEIGHT_MIN || height > CONSTANTS.PHYSICAL.HEIGHT_MAX) {
          errors.height = `èº«é«˜å¿…é ˆåœ¨ ${CONSTANTS.PHYSICAL.HEIGHT_MIN}-${CONSTANTS.PHYSICAL.HEIGHT_MAX} å…¬åˆ†ä¹‹é–“`;
        }
        
        if (!formData.weight || isNaN(weight) || weight < CONSTANTS.PHYSICAL.WEIGHT_MIN || weight > CONSTANTS.PHYSICAL.WEIGHT_MAX) {
          errors.weight = `é«”é‡å¿…é ˆåœ¨ ${CONSTANTS.PHYSICAL.WEIGHT_MIN}-${CONSTANTS.PHYSICAL.WEIGHT_MAX} å…¬æ–¤ä¹‹é–“`;
        }
        
        return {
          isValid: Object.keys(errors).length === 0,
          errors
        };
      };
      
      // === é¢¨éšªè¨ˆç®—å‡½å¼ ===
      const calculateASAScore = (formData, bmi) => {
        let asaScore = 1;
        const bmiValue = parseFloat(bmi);
        
        const hasMildDisease = formData.hypertension || 
                              formData.diabetes || 
                              (bmiValue >= CONSTANTS.BMI.OBESE && bmiValue < CONSTANTS.BMI.OBESE) || 
                              formData.smoker !== 'no';
                              
        const hasSevereDisease = formData.coronary_artery_disease || 
                                formData.heart_failure || 
                                formData.copd || 
                                formData.renal_disease || 
                                (bmiValue >= CONSTANTS.BMI.OBESE);
        
        if (hasSevereDisease) {
          asaScore = 3;
        } else if (hasMildDisease) {
          asaScore = 2;
        }
        
        if (formData.heart_failure || formData.stroke) {
          asaScore = Math.max(asaScore, 3);
        }
        
        return asaScore;
      };
      
      const calculateCardiacRisk = (formData) => {
        let points = 0;
        if (formData.coronary_artery_disease) points++;
        if (formData.heart_failure) points++;
        if (formData.stroke) points++;
        if (formData.diabetes) points++;
        if (formData.renal_disease) points++;
        return points;
      };
      
      const calculateStopBangScore = (formData, bmi) => {
        let score = 0;
        const age = parseInt(formData.age);
        const bmiValue = parseFloat(bmi);
        
        if (formData.snoring) score++;
        if (formData.tired) score++;
        if (formData.observed_apnea) score++;
        if (formData.hypertension) score++;
        if (bmiValue > 35) score++;
        if (age > CONSTANTS.AGE.ELDERLY) score++;
        if (formData.gender === 'male') score++;
        
        return score;
      };
      
      const analyzeRiskFactors = (formData, bmi, cardiacRiskPoints, stopBangScore) => {
        const riskFactors = [];
        const bmiValue = parseFloat(bmi);
        
        // å¿ƒè¡€ç®¡é¢¨éšªå› å­
        if (formData.coronary_artery_disease) {
          riskFactors.push({ text: 'å† ç‹€å‹•è„ˆç–¾ç—… (å¿ƒè‡Ÿé¢¨éšªå› å­)', level: RISK_LEVELS.HIGH });
        }
        if (formData.heart_failure) {
          riskFactors.push({ text: 'å¿ƒè‡Ÿè¡°ç«­ (å¿ƒè‡Ÿé¢¨éšªå› å­)', level: RISK_LEVELS.HIGH });
        }
        if (formData.stroke) {
          riskFactors.push({ text: 'æ›¾æœ‰ä¸­é¢¨ç—…å² (å¿ƒè‡Ÿé¢¨éšªå› å­)', level: RISK_LEVELS.HIGH });
        }
        if (formData.diabetes) {
          riskFactors.push({ text: 'ç³–å°¿ç—… (å¿ƒè‡Ÿé¢¨éšªå› å­)', level: RISK_LEVELS.MEDIUM });
        }
        if (formData.renal_disease) {
          riskFactors.push({ text: 'æ…¢æ€§è…è‡Ÿç—… (å¿ƒè‡Ÿé¢¨éšªå› å­)', level: RISK_LEVELS.HIGH });
        }
        
        // OSA é¢¨éšª
        if (stopBangScore >= CONSTANTS.SCORES.STOP_BANG_HIGH_RISK) {
          const level = stopBangScore >= CONSTANTS.SCORES.STOP_BANG_VERY_HIGH_RISK ? RISK_LEVELS.HIGH : RISK_LEVELS.HIGH;
          riskFactors.push({
            text: `ç¡çœ å‘¼å¸ä¸­æ­¢ç—‡ (OSA) é¢¨éšªè¼ƒé«˜ (STOP-Bang åˆ†æ•¸: ${stopBangScore})`,
            level
          });
        } else if (stopBangScore > 0) {
          riskFactors.push({
            text: `æœ‰ç¡çœ å‘¼å¸ä¸­æ­¢ç—‡ (OSA) é¢¨éšªå› å­ (STOP-Bang åˆ†æ•¸: ${stopBangScore})`,
            level: RISK_LEVELS.MEDIUM
          });
        }
        
        // å…¶ä»–é¢¨éšªå› å­
        if (bmiValue >= CONSTANTS.BMI.OBESE) {
          riskFactors.push({ text: `è‚¥èƒ– (BMI: ${bmiValue})`, level: RISK_LEVELS.MEDIUM });
        }
        if (formData.smoker !== 'no') {
          riskFactors.push({ text: 'å¸è¸', level: RISK_LEVELS.MEDIUM });
        }
        if (formData.prior_anesthesia_issues) {
          riskFactors.push({ text: 'æ›¾æœ‰éº»é†‰ç›¸é—œä½µç™¼ç—‡å²', level: RISK_LEVELS.HIGH });
        }
        if (formData.allergies) {
          riskFactors.push({ text: `è—¥ç‰©éæ•å²: ${formData.allergies}`, level: RISK_LEVELS.HIGH });
        }
        if (formData.copd || formData.asthma) {
          riskFactors.push({ text: 'å‘¼å¸ç³»çµ±ç–¾ç—… (æ°£å–˜/æ…¢æ€§é˜»å¡æ€§è‚ºç—…)', level: RISK_LEVELS.MEDIUM });
        }
        
        return riskFactors;
      };
      
      const calculateOverallRisk = (asaScore, cardiacRiskPoints, stopBangScore) => {
        if (asaScore >= 3 || 
            cardiacRiskPoints >= CONSTANTS.SCORES.CARDIAC_HIGH_RISK || 
            stopBangScore >= CONSTANTS.SCORES.STOP_BANG_VERY_HIGH_RISK) {
          return RISK_LEVELS.HIGH;
        } else if (asaScore === 2 || 
                   cardiacRiskPoints === 1 || 
                   stopBangScore >= CONSTANTS.SCORES.STOP_BANG_HIGH_RISK) {
          return RISK_LEVELS.MEDIUM;
        }
        return RISK_LEVELS.LOW;
      };
      
      // === åœ–ç¤ºå…ƒä»¶ ===
      const CheckCircleIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
      );
      
      const AlertTriangleIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
          <path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
          <line x1="12" x2="12" y1="9" y2="13"/>
          <line x1="12" x2="12.01" y1="17" y2="17"/>
        </svg>
      );
      
      const HeartIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      );
      
      const LungsIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
          <path d="M3 12h3a3 3 0 0 1 3 3v5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-5a3 3 0 0 1 3-3h3"/>
          <path d="M9 10V4.5a2.5 2.5 0 0 1 5 0V10"/>
          <path d="M9 4h6"/>
        </svg>
      );
      
      // === è¼¸å…¥å…ƒä»¶ ===
      const ErrorBoundary = ({ children }) => {
        const [hasError, setHasError] = useState(false);
        
        useEffect(() => {
          const handleError = () => setHasError(true);
          window.addEventListener('error', handleError);
          return () => window.removeEventListener('error', handleError);
        }, []);
        
        if (hasError) {
          return (
            <div className="text-center p-8">
              <AlertTriangleIcon className="mx-auto h-16 w-16 text-red-500 mb-4" />
              <h2 className="text-xl font-bold text-red-600 mb-2">ç™¼ç”ŸéŒ¯èª¤</h2>
              <p className="text-gray-600 mb-4">æŠ±æ­‰ï¼Œæ‡‰ç”¨ç¨‹å¼é‡åˆ°äº†å•é¡Œã€‚è«‹é‡æ–°æ•´ç†é é¢å†è©¦ä¸€æ¬¡ã€‚</p>
              <button 
                onClick={() => window.location.reload()} 
                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
              >
                é‡æ–°æ•´ç†é é¢
              </button>
            </div>
          );
        }
        
        return children;
      };
      
      const InputField = ({ label, name, type = "text", value, onChange, error, placeholder, min, max, required = false }) => (
        <div>
          <label htmlFor={name} className="block text-sm font-normal text-emerald-950 mb-1">
            {label} {required && <span className="text-red-500">*</span>}
          </label>
          <input
            type={type}
            name={name}
            id={name}
            value={value}
            onChange={onChange}
            min={min}
            max={max}
            className={`mt-1 block w-full rounded-md shadow-sm sm:text-sm focus-enhanced ${
              error 
                ? 'border-red-500 focus:border-red-500 focus:ring-red-500' 
                : 'border-stone-300 focus:border-red-500 focus:ring-red-500'
            }`}
            placeholder={placeholder}
            aria-describedby={error ? `${name}-error` : undefined}
            aria-invalid={error ? 'true' : 'false'}
          />
          {error && (
            <p id={`${name}-error`} className="mt-1 text-sm text-red-600" role="alert">
              {error}
            </p>
          )}
        </div>
      );
      
      const CheckboxInput = ({ id, label, checked, onChange, description }) => (
        <div className="relative flex items-start">
          <div className="flex h-5 items-center">
            <input
              id={id}
              name={id}
              type="checkbox"
              checked={checked}
              onChange={onChange}
              className="h-4 w-4 rounded border-stone-300 text-red-600 focus:ring-red-500 focus-enhanced"
              aria-describedby={description ? `${id}-description` : undefined}
            />
          </div>
          <div className="ml-3 text-sm">
            <label htmlFor={id} className="font-normal text-emerald-950 cursor-pointer">
              {label}
            </label>
            {description && (
              <p id={`${id}-description`} className="font-normal text-emerald-950 text-xs mt-1">
                {description}
              </p>
            )}
          </div>
        </div>
      );
      
      // === æ­¥é©Ÿå…ƒä»¶ ===
      const Step1 = ({ formData, handleChange, bmi, errors }) => (
        <div className="slide-in">
          <h2 className="text-2xl font-bold text-red-600 mb-6">1. åŸºæœ¬è³‡æ–™</h2>
          <div className="space-y-4">
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <InputField
                label="å¹´é½¡"
                name="age"
                type="number"
                value={formData.age}
                onChange={handleChange}
                error={errors.age}
                placeholder="ä¾‹å¦‚: 55"
                min={CONSTANTS.AGE.MIN}
                max={CONSTANTS.AGE.MAX}
                required
              />
              <div>
                <label htmlFor="gender" className="block text-sm font-normal text-emerald-950 mb-1">
                  ç”Ÿç†æ€§åˆ¥ <span className="text-red-500">*</span>
                </label>
                <select 
                  name="gender" 
                  id="gender" 
                  value={formData.gender} 
                  onChange={handleChange} 
                  className="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm focus-enhanced"
                >
                  <option value="male">ç”·</option>
                  <option value="female">å¥³</option>
                </select>
              </div>
            </div>
            
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <InputField
                label="èº«é«˜ (cm)"
                name="height"
                type="number"
                value={formData.height}
                onChange={handleChange}
                error={errors.height}
                placeholder="ä¾‹å¦‚: 170"
                min={CONSTANTS.PHYSICAL.HEIGHT_MIN}
                max={CONSTANTS.PHYSICAL.HEIGHT_MAX}
                required
              />
              <InputField
                label="é«”é‡ (kg)"
                name="weight"
                type="number"
                value={formData.weight}
                onChange={handleChange}
                error={errors.weight}
                placeholder="ä¾‹å¦‚: 75"
                min={CONSTANTS.PHYSICAL.WEIGHT_MIN}
                max={CONSTANTS.PHYSICAL.WEIGHT_MAX}
                required
              />
            </div>
            
            {bmi && (
              <div className="p-3 bg-red-50 rounded-lg text-center">
                <p className="font-semibold text-red-800">
                  æ‚¨çš„èº«é«”è³ªé‡æŒ‡æ•¸ (BMI) ç‚º: <span className="text-xl">{bmi}</span>
                </p>
                <p className="text-sm text-red-600 mt-1">
                  {parseFloat(bmi) < CONSTANTS.BMI.UNDERWEIGHT && "é«”é‡éè¼•"}
                  {parseFloat(bmi) >= CONSTANTS.BMI.UNDERWEIGHT && parseFloat(bmi) < CONSTANTS.BMI.NORMAL && "æ­£å¸¸é«”é‡"}
                  {parseFloat(bmi) >= CONSTANTS.BMI.NORMAL && parseFloat(bmi) < CONSTANTS.BMI.OBESE && "éé‡"}
                  {parseFloat(bmi) >= CONSTANTS.BMI.OBESE && "è‚¥èƒ–"}
                </p>
              </div>
            )}
          </div>
        </div>
      );
      
      const Step2 = ({ formData, handleChange }) => (
        <div className="slide-in">
          <h2 className="text-2xl font-bold text-red-600 mb-6">2. ç³»çµ±æ€§ç—…å²</h2>
          <p className="text-sm font-normal text-emerald-950 mb-6">
            è«‹å‹¾é¸æ‰€æœ‰è¢«é†«å¸«è¨ºæ–·éçš„ç–¾ç—…ã€‚è‹¥ä¸ç¢ºå®šï¼Œè«‹è«®è©¢é†«å¸«æˆ–æš«æ™‚ä¸å‹¾é¸ã€‚
          </p>
          <div className="space-y-6">
            <fieldset>
              <legend className="text-lg font-bold text-red-600 flex items-center mb-3">
                <HeartIcon className="mr-2 text-red-500" />
                å¿ƒè¡€ç®¡ç³»çµ±
              </legend>
              <div className="space-y-4 pl-4 border-l-2 border-stone-200" role="group" aria-labelledby="cardiovascular-group">
                <CheckboxInput 
                  id="hypertension" 
                  label="é«˜è¡€å£“ (å¤§æ–¼140/90 mmHg)" 
                  checked={formData.hypertension} 
                  onChange={handleChange} 
                />
                <CheckboxInput 
                  id="coronary_artery_disease" 
                  label="å† ç‹€å‹•è„ˆç–¾ç—…" 
                  description="ä¾‹å¦‚: å¿ƒçµç—›ã€æ›¾å¿ƒè‚Œæ¢—å¡ã€åšéå¿ƒå°ç®¡æ”¯æ¶"
                  checked={formData.coronary_artery_disease} 
                  onChange={handleChange} 
                />
                <CheckboxInput 
                  id="heart_failure" 
                  label="å¿ƒè‡Ÿè¡°ç«­" 
                  description="é†«å¸«æ›¾èªªæ‚¨çš„å¿ƒè‡ŸåŠŸèƒ½è¼ƒç„¡åŠ›ã€å¿ƒè‡Ÿæ“´å¤§"
                  checked={formData.heart_failure} 
                  onChange={handleChange} 
                />
                <CheckboxInput 
                  id="arrhythmia" 
                  label="å¿ƒå¾‹ä¸æ•´" 
                  description="ä¾‹å¦‚: å¿ƒæˆ¿é¡«å‹•"
                  checked={formData.arrhythmia} 
                  onChange={handleChange} 
                />
                <CheckboxInput 
                  id="stroke" 
                  label="ä¸­é¢¨æˆ–çŸ­æš«æ€§è…¦ç¼ºè¡€ (å°ä¸­é¢¨)" 
                  checked={formData.stroke} 
                  onChange={handleChange} 
                />
              </div>
            </fieldset>
            
            <fieldset>
              <legend className="text-lg font-bold text-red-600 flex items-center mb-3">
                <LungsIcon className="mr-2 text-red-500" />
                å‘¼å¸ç³»çµ±èˆ‡å…¶ä»–
              </legend>
              <div className="space-y-4 pl-4 border-l-2 border-stone-200" role="group" aria-labelledby="respiratory-group">
                <CheckboxInput id="asthma" label="æ°£å–˜" checked={formData.asthma} onChange={handleChange} />
                <CheckboxInput id="copd" label="æ…¢æ€§é˜»å¡æ€§è‚ºç—…" checked={formData.copd} onChange={handleChange} />
                <CheckboxInput id="sleep_apnea" label="ç¡çœ å‘¼å¸ä¸­æ­¢ç—‡" checked={formData.sleep_apnea} onChange={handleChange} />
                <CheckboxInput id="diabetes" label="ç³–å°¿ç—…" checked={formData.diabetes} onChange={handleChange} />
                <CheckboxInput id="renal_disease" label="æ…¢æ€§è…è‡Ÿç—…" checked={formData.renal_disease} onChange={handleChange} />
              </div>
            </fieldset>
          </div>
        </div>
      );
      
      const Step3 = ({ formData, handleChange }) => (
        <div className="slide-in">
          <h2 className="text-2xl font-bold text-red-600 mb-6">3. ç”Ÿæ´»ç¿’æ…£èˆ‡éº»é†‰å²</h2>
          <div className="space-y-6">
            <fieldset>
              <legend className="block text-sm font-normal text-emerald-950 mb-2">å¸è¸ç¿’æ…£</legend>
              <div className="flex flex-wrap gap-4 font-normal text-emerald-950" role="radiogroup">
                <label className="flex items-center cursor-pointer">
                  <input 
                    type="radio" 
                    name="smoker" 
                    value="no" 
                    checked={formData.smoker === 'no'} 
                    onChange={handleChange} 
                    className="mr-2 text-red-600 focus:ring-red-500 focus-enhanced" 
                  /> 
                  ç„¡
                </label>
                <label className="flex items-center cursor-pointer">
                  <input 
                    type="radio" 
                    name="smoker" 
                    value="yes" 
                    checked={formData.smoker === 'yes'} 
                    onChange={handleChange} 
                    className="mr-2 text-red-600 focus:ring-red-500 focus-enhanced" 
                  /> 
                  æ˜¯
                </label>
                <label className="flex items-center cursor-pointer">
                  <input 
                    type="radio" 
                    name="smoker" 
                    value="former" 
                    checked={formData.smoker === 'former'} 
                    onChange={handleChange} 
                    className="mr-2 text-red-600 focus:ring-red-500 focus-enhanced" 
                  /> 
                  å·²æˆ’è¸
                </label>
              </div>
            </fieldset>
            
            <fieldset>
              <legend className="block text-sm font-normal text-emerald-950 mb-2">é£²é…’ç¿’æ…£</legend>
              <div className="flex flex-wrap gap-4 font-normal text-emerald-950" role="radiogroup">
                <label className="flex items-center cursor-pointer">
                  <input 
                    type="radio" 
                    name="alcohol" 
                    value="no" 
                    checked={formData.alcohol === 'no'} 
                    onChange={handleChange} 
                    className="mr-2 text-red-600 focus:ring-red-500 focus-enhanced" 
                  /> 
                  ç„¡æˆ–æ¥µå°‘
                </label>
                <label className="flex items-center cursor-pointer">
                  <input 
                    type="radio" 
                    name="alcohol" 
                    value="social" 
                    checked={formData.alcohol === 'social'} 
                    onChange={handleChange} 
                    className="mr-2 text-red-600 focus:ring-red-500 focus-enhanced" 
                  /> 
                  ç¤¾äº¤æ€§é£²é…’
                </label>
                <label className="flex items-center cursor-pointer">
                  <input 
                    type="radio" 
                    name="alcohol" 
                    value="daily" 
                    checked={formData.alcohol === 'daily'} 
                    onChange={handleChange} 
                    className="mr-2 text-red-600 focus:ring-red-500 focus-enhanced" 
                  /> 
                  æ¯æ—¥é£²é…’
                </label>
              </div>
            </fieldset>
            
            <hr className="border-stone-200"/>
            
            <div>
              <CheckboxInput
                id="prior_anesthesia_issues"
                label="éå»æˆ–å®¶æ—æœ‰éº»é†‰ç›¸é—œä½µç™¼ç—‡å²"
                description="ä¾‹å¦‚: åš´é‡è¡“å¾Œå™å¿ƒå˜”åã€æƒ¡æ€§é«˜ç†±ã€ç”¦é†’å›°é›£"
                checked={formData.prior_anesthesia_issues}
                onChange={handleChange}
              />
            </div>
            
            <div>
              <label htmlFor="allergies" className="block text-sm font-normal text-emerald-950 mb-1">
                æ‚¨æ˜¯å¦æœ‰ä»»ä½•è—¥ç‰©éæ•å²ï¼Ÿ
              </label>
              <textarea 
                name="allergies" 
                id="allergies" 
                value={formData.allergies} 
                onChange={handleChange} 
                rows="3" 
                className="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm font-normal text-emerald-950 focus-enhanced" 
                placeholder="è‹¥ç„¡è«‹ç•™ç™½ã€‚è‹¥æœ‰ï¼Œè«‹å¡«å¯«è—¥ç‰©åç¨±ï¼Œä¾‹å¦‚: ç›¤å°¼è¥¿æ— (Penicillin)"
                aria-describedby="allergies-help"
              />
              <p id="allergies-help" className="mt-1 text-xs text-gray-500">
                è«‹è©³ç´°æè¿°éæ•åæ‡‰ï¼Œä¾‹å¦‚ï¼šçš®ç–¹ã€å‘¼å¸å›°é›£ç­‰
              </p>
            </div>
          </div>
        </div>
      );
      
      const Step4 = ({ formData, handleChange }) => (
        <div className="slide-in">
          <h2 className="text-2xl font-bold text-red-600 mb-6">4. ç¡çœ å‘¼å¸ä¸­æ­¢ç—‡ (OSA) é¢¨éšªè‡ªè©•</h2>
          <p className="text-sm font-normal text-emerald-950 mb-6">
            é€™æ˜¯ä¸€ä»½åœ‹éš›é€šç”¨çš„ STOP-Bang å•å·ï¼Œè«‹ä¾æ“šè‡ªå·±çœŸå¯¦æƒ…æ³å›ç­”ã€‚
          </p>
          <fieldset className="space-y-4 bg-stone-100 p-4 rounded-lg">
            <legend className="sr-only">STOP-Bang å•å·</legend>
            <CheckboxInput 
              id="snoring" 
              label="æ‰“é¼¾: æœƒå¤§è²æ‰“é¼¾å—ï¼Ÿï¼ˆæ¯”èªªè©±å¤§è²ï¼Œæˆ–é—œè‘—æˆ¿é–€éƒ½è½å¾—åˆ°ï¼‰" 
              checked={formData.snoring} 
              onChange={handleChange} 
            />
            <CheckboxInput 
              id="tired" 
              label="ç–²å€¦: ç™½å¤©æ˜¯å¦ç¶“å¸¸æ„Ÿåˆ°ç–²å€¦ã€ç–²å‹æˆ–æƒ³ç¡ï¼Ÿ" 
              checked={formData.tired} 
              onChange={handleChange} 
            />
            <CheckboxInput 
              id="observed_apnea" 
              label="è§€å¯Ÿåˆ°å‘¼å¸ä¸­æ­¢: æ˜¯å¦æœ‰äººè§€å¯Ÿåˆ°åœ¨ç¡çœ ä¸­åœæ­¢å‘¼å¸ï¼Ÿ" 
              checked={formData.observed_apnea} 
              onChange={handleChange} 
            />
            <CheckboxInput 
              id="hypertension" 
              label="é«˜è¡€å£“: æ‚¨ç›®å‰æ˜¯å¦æ­£åœ¨ç‚ºé«˜è¡€å£“å•é¡Œæ¥å—æ²»ç™‚ï¼Ÿ" 
              checked={formData.hypertension} 
              onChange={handleChange} 
            />
          </fieldset>
        </div>
      );
      
      const ProgressBar = ({ currentStep, totalSteps }) => (
        <div className="w-full bg-stone-200 rounded-full h-2.5 mb-8" role="progressbar" aria-valuenow={currentStep} aria-valuemin="1" aria-valuemax={totalSteps}>
          <div 
            className="bg-red-600 h-2.5 rounded-full transition-all duration-500" 
            style={{ width: `${(currentStep / totalSteps) * 100}%` }}
          />
          <div className="sr-only">é€²åº¦ï¼šç¬¬ {currentStep} æ­¥ï¼Œå…± {totalSteps} æ­¥</div>
        </div>
      );
      
      const ResultsScreen = ({ results, restart, formData }) => {
        const { overallRisk, riskFactors, asaScore, cardiacRiskPoints, stopBangScore } = results;
        
        const handleShareOrPrint = useCallback(() => {
          const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
          
          if (isMobile && navigator.share) {
            // ä½¿ç”¨åŸç”Ÿåˆ†äº«åŠŸèƒ½ï¼ˆå¦‚æœæ”¯æ´ï¼‰
            navigator.share({
              title: 'éº»é†‰é¢¨éšªè©•ä¼°å ±å‘Š',
              text: 'æˆ‘çš„è¡“å‰éº»é†‰é¢¨éšªè©•ä¼°çµæœ',
              url: window.location.href
            }).catch(err => {
              console.log('åˆ†äº«åŠŸèƒ½ç™¼ç”ŸéŒ¯èª¤:', err);
              handlePrint();
            });
          } else {
            handlePrint();
          }
        }, []);
        
        const handleExportData = useCallback(() => {
          const exportData = {
            timestamp: new Date().toISOString(),
            formData,
            results
          };
          
          const dataStr = JSON.stringify(exportData, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(dataBlob);
          
          const link = document.createElement('a');
          link.href = url;
          link.download = `anesthesia_risk_assessment_${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }, [formData, results]);
        
        return (
          <div className="print-container slide-in">
            <div className="text-center mb-8">
              <h2 className="text-3xl font-bold text-emerald-950">æ‚¨çš„éº»é†‰é¢¨éšªè©•ä¼°å ±å‘Š</h2>
              <p className="font-normal text-emerald-950 mt-2">é€™æ˜¯ä¸€ä»½åŸºæ–¼æ‚¨æ‰€æä¾›è³‡è¨Šçš„åˆæ­¥åˆ†æ</p>
              <p className="text-xs text-gray-500 mt-1">è©•ä¼°æ™‚é–“ï¼š{new Date().toLocaleString('zh-TW')}</p>
            </div>
            
            <div className={`p-6 rounded-lg border-l-4 ${RISK_COLORS[overallRisk]} mb-8`}>
              <h3 className="text-xl font-bold">ç¶œåˆé¢¨éšªè©•ä¼°ï¼š{RISK_TEXT[overallRisk]}</h3>
              <p className="mt-2 font-normal">
                æ­¤è©•ä¼°ç¶œåˆè€ƒé‡äº†æ‚¨çš„å¹´é½¡ã€å¥åº·ç‹€æ³èˆ‡ç”Ÿæ´»ç¿’æ…£ã€‚é¢¨éšªç­‰ç´šæ„ˆé«˜ï¼Œä»£è¡¨éº»é†‰éç¨‹ä¸­éœ€è¦ç‰¹åˆ¥ç•™æ„çš„æ½›åœ¨å•é¡Œæ„ˆå¤šï¼Œæ‚¨çš„éº»é†‰é†«å¸«æœƒç‚ºæ­¤åˆ¶å®šæ›´å‘¨å…¨çš„è¨ˆç•«ã€‚
              </p>
            </div>
            
            <div className="mb-8">
              <h3 className="text-xl font-bold text-red-600 mb-4">ä¸»è¦é¢¨éšªå› å­æ‘˜è¦</h3>
              {riskFactors.length > 0 ? (
                <ul className="space-y-3" role="list">
                  {riskFactors.map((factor, index) => (
                    <li key={index} className="flex items-start p-3 bg-stone-100 rounded-md" role="listitem">
                      <AlertTriangleIcon 
                        className={`h-5 w-5 mr-3 mt-1 flex-shrink-0 ${
                          factor.level === RISK_LEVELS.HIGH ? 'text-red-500' : 'text-orange-500'
                        }`} 
                      />
                      <span className="font-normal text-emerald-950">{factor.text}</span>
                    </li>
                  ))}
                </ul>
              ) : (
                <div className="flex items-center p-3 bg-emerald-50 rounded-md">
                  <CheckCircleIcon className="h-5 w-5 mr-3 text-emerald-600 flex-shrink-0" />
                  <span className="font-normal text-emerald-950">æ ¹æ“šæ‚¨æä¾›çš„è³‡è¨Šï¼Œæœªç™¼ç¾é¡¯è‘—çš„éº»é†‰é¢¨éšªå› å­ã€‚</span>
                </div>
              )}
            </div>
            
            <div className="mb-8">
              <h3 className="text-xl font-bold text-red-600 mb-4">ä½ çš„ã€Œå®‰å¿ƒæ‰‹è¡“ã€è¡Œå‹•æ¸…å–® âœ…</h3>
              <div className="bg-emerald-50 p-4 rounded-lg border border-emerald-200 space-y-4 font-normal text-emerald-950">
                <p><span className="font-bold">1. å­˜ä¸‹ä½ çš„å¥åº·æª”æ¡ˆ ğŸ“‚</span>ï¼šé»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼ŒæŠŠé€™ä»½å ±å‘Šå­˜æˆ PDF æˆ–åŒ¯å‡ºè³‡æ–™</p>
                <p><span className="font-bold">2. æˆç‚ºé†«å¸«çš„ç¥éšŠå‹ ğŸ¤</span>ï¼šè¡“å‰è«®è©¢æ™‚ï¼Œç”¨å®ƒä¾†å¹«åŠ©ä½ æ›´ç²¾æº–åœ°æå•ï¼Œä¹Ÿè®“é†«å¸«æ›´å¿«äº†è§£ä½ çš„ç‹€æ³ã€‚</p>
                <p><span className="font-bold">3. ç›¤é»ä½ çš„æ—¥å¸¸ç”¨è—¥ ğŸ’Š</span>ï¼šä¸»å‹•å’Œé†«å¸«èŠèŠä½ æ­£åœ¨ä½¿ç”¨çš„è—¥ç‰©ï¼Œç‰¹åˆ¥æ˜¯æŠ—å‡è¡€åŠ‘ã€è¡€ç³–è—¥ç­‰ã€‚ç¢ºèªå“ªäº›è¦ç¹¼çºŒã€å“ªäº›è©²æš«åœï¼Œæ˜¯å®‰å…¨çš„ç¬¬ä¸€æ­¥ã€‚</p>
                <p className="font-bold pt-2">äº†è§£è‡ªå·±ï¼Œæ˜¯æœ€å¥½çš„å¥åº·æŠ•è³‡ã€‚é€™ä»½å ±å‘Šå°±æ˜¯ä½ çš„ã€Œæºé€šåˆ©å™¨ã€ï¼Œå¹«åŠ©ä½ å’Œé†«ç™‚åœ˜éšŠä¸€èµ·ï¼Œæ‰“é€ æœ€å®‰å¿ƒçš„æ‰‹è¡“æ—…ç¨‹ âœ¨</p>
              </div>
            </div>
            
            <div className="bg-stone-100 p-4 rounded-lg mb-8">
              <h3 className="text-lg font-bold text-red-600 mb-2">è©³ç´°è©•ä¼°æŒ‡æ¨™</h3>
              <div className="space-y-2">
                <p className="text-sm font-normal text-emerald-950">
                  <strong>é ä¼° ASA èº«é«”ç‹€æ³åˆ†ç´š:</strong> {asaScore} ç´š
                </p>
                <p className="text-xs font-normal text-emerald-950 mb-2">
                  {ASA_DESCRIPTIONS[asaScore]}
                </p>
                <p className="text-sm font-normal text-emerald-950">
                  <strong>å¿ƒè¡€ç®¡é¢¨éšªæŒ‡æ•¸ (RCRI) é»æ•¸:</strong> {cardiacRiskPoints} é» 
                  <span className="text-xs">(é»æ•¸æ„ˆé«˜ï¼Œå¿ƒè‡Ÿä½µç™¼ç—‡é¢¨éšªæ„ˆé«˜)</span>
                </p>
                <p className="text-sm font-normal text-emerald-950">
                  <strong>ç¡çœ å‘¼å¸ä¸­æ­¢ç—‡ (STOP-Bang) åˆ†æ•¸:</strong> {stopBangScore} åˆ† 
                  <span className="text-xs">(3åˆ†ä»¥ä¸Šè¡¨ç¤ºé¢¨éšªè¼ƒé«˜)</span>
                </p>
              </div>
            </div>
            
            <div className="mt-10 flex flex-col sm:flex-row justify-center gap-4 no-print">
              <button
                onClick={handleShareOrPrint}
                className="w-full sm:w-auto px-8 py-3 bg-red-600 text-white rounded-lg font-semibold text-base hover:bg-red-700 transition-colors focus-enhanced"
                aria-label="åˆ—å°ã€å„²å­˜ç‚º PDF æˆ–åˆ†äº«"
              >
                ğŸ“„ åˆ—å° / å„²å­˜ PDF / åˆ†äº«
              </button>
              <button
                onClick={handleExportData}
                className="w-full sm:w-auto px-8 py-3 bg-blue-600 text-white rounded-lg font-semibold text-base hover:bg-blue-700 transition-colors focus-enhanced"
                aria-label="åŒ¯å‡ºè©•ä¼°è³‡æ–™"
              >
                ğŸ’¾ åŒ¯å‡ºè³‡æ–™
              </button>
              <button
                onClick={restart}
                className="w-full sm:w-auto px-8 py-3 bg-slate-500 text-white rounded-lg font-semibold text-base hover:bg-slate-600 transition-colors focus-enhanced"
                aria-label="é‡æ–°é–‹å§‹è©•ä¼°"
              >
                ğŸ”„ é‡æ–°è©•ä¼°
              </button>
            </div>
          </div>
        );
      };
      
      // === ä¸»è¦æ‡‰ç”¨ç¨‹å¼å…ƒä»¶ ===
      function App() {
        const [step, setStep] = useState(1);
        const [formData, setFormData] = useState({
          age: '',
          gender: 'male',
          height: '',
          weight: '',
          hypertension: false,
          coronary_artery_disease: false,
          heart_failure: false,
          arrhythmia: false,
          stroke: false,
          asthma: false,
          copd: false,
          sleep_apnea: false,
          diabetes: false,
          renal_disease: false,
          smoker: 'no',
          alcohol: 'no',
          prior_anesthesia_issues: false,
          allergies: '',
          snoring: false,
          tired: false,
          observed_apnea: false,
        });
        const [errors, setErrors] = useState({});
        
        const stepRef = useRef(null);
        
        // ç„¦é»ç®¡ç†
        useEffect(() => {
          if (stepRef.current) {
            stepRef.current.focus();
          }
        }, [step]);
        
        const handleNext = useCallback(() => {
          if (step === 1) {
            const validation = validateStep1(formData);
            if (!validation.isValid) {
              setErrors(validation.errors);
              return;
            }
            setErrors({});
          }
          setStep(s => Math.min(s + 1, CONSTANTS.TOTAL_STEPS + 1));
        }, [step, formData]);
        
        const handleBack = useCallback(() => {
          setStep(s => Math.max(s - 1, 1));
          setErrors({});
        }, []);
        
        const restart = useCallback(() => {
          setStep(1);
          setFormData({
            age: '',
            gender: 'male',
            height: '',
            weight: '',
            hypertension: false,
            coronary_artery_disease: false,
            heart_failure: false,
            arrhythmia: false,
            stroke: false,
            asthma: false,
            copd: false,
            sleep_apnea: false,
            diabetes: false,
            renal_disease: false,
            smoker: 'no',
            alcohol: 'no',
            prior_anesthesia_issues: false,
            allergies: '',
            snoring: false,
            tired: false,
            observed_apnea: false,
          });
          setErrors({});
        }, []);
        
        const handleChange = useCallback((e) => {
          const { name, value, type, checked } = e.target;
          setFormData(prev => ({
            ...prev,
            [name]: type === 'checkbox' ? checked : value
          }));
          
          // æ¸…é™¤å°æ‡‰æ¬„ä½çš„éŒ¯èª¤è¨Šæ¯
          if (errors[name]) {
            setErrors(prev => ({
              ...prev,
              [name]: undefined
            }));
          }
        }, [errors]);
        
        const bmi = useMemo(() => calculateBMI(formData.height, formData.weight), [formData.height, formData.weight]);
        
        const analysisResults = useMemo(() => {
          const asaScore = calculateASAScore(formData, bmi);
          const cardiacRiskPoints = calculateCardiacRisk(formData);
          const stopBangScore = calculateStopBangScore(formData, bmi);
          const riskFactors = analyzeRiskFactors(formData, bmi, cardiacRiskPoints, stopBangScore);
          const overallRisk = calculateOverallRisk(asaScore, cardiacRiskPoints, stopBangScore);
          
          return {
            asaScore,
            cardiacRiskPoints,
            stopBangScore,
            riskFactors,
            overallRisk
          };
        }, [formData, bmi]);
        
        const validation = useMemo(() => validateStep1(formData), [formData]);
        
        const renderStep = () => {
          const stepProps = {
            formData,
            handleChange,
            bmi,
            errors
          };
          
          switch (step) {
            case 1:
              return <Step1 {...stepProps} />;
            case 2:
              return <Step2 {...stepProps} />;
            case 3:
              return <Step3 {...stepProps} />;
            case 4:
              return <Step4 {...stepProps} />;
            case 5:
              return <ResultsScreen results={analysisResults} restart={restart} formData={formData} />;
            default:
              return (
                <div className="text-center">
                  <AlertTriangleIcon className="mx-auto h-16 w-16 text-red-500 mb-4" />
                  <p className="text-red-600">ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹é‡æ–°é–‹å§‹</p>
                </div>
              );
          }
        };
        
        return (
          <ErrorBoundary>
            <div className="min-h-screen flex flex-col items-center p-4 sm:p-6 lg:p-8">
              <div className="w-full max-w-2xl mx-auto">
                <header className="text-center mb-6">
                  <h1 className="text-3xl sm:text-4xl font-bold text-emerald-950">
                    <span className="text-red-600">éº»é†‰é¢¨éšª</span>çŸ¥å¤šå°‘ï¼Ÿä¸€åˆ†é˜è‡ªæˆ‘è©•ä¼°
                  </h1>
                  <p className="font-normal text-emerald-950 mt-2">
                    &lt;èŠ±å¹¾åˆ†é˜äº†è§£è‡ªå·±ï¼Œè¡“å‰æºé€šæ›´é †åˆ©&gt;
                  </p>
                </header>
                
                <main className="bg-white rounded-xl shadow-lg p-6 sm:p-8">
                  <div className="bg-orange-100 border-l-4 border-orange-400 p-4 rounded-md mb-8" role="alert">
                    <div className="flex">
                      <AlertTriangleIcon className="h-6 w-6 mr-4 text-orange-500 flex-shrink-0" />
                      <div>
                        <p className="font-bold text-red-600">é‡è¦å…è²¬è²æ˜</p>
                        <p className="text-sm font-normal text-emerald-950">
                          æ­¤å·¥å…·çµæœåƒ…ä¾›åƒè€ƒï¼Œä¸èƒ½å–ä»£å°ˆæ¥­é†«ç™‚è©•ä¼°ã€‚æ‰€æœ‰éº»é†‰æ±ºç­–è«‹å‹™å¿…èˆ‡æ‚¨çš„éº»é†‰ç§‘é†«å¸«ã€å¤–ç§‘é†«å¸«é€²è¡Œè©³ç´°è¨è«–ã€‚
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  {step <= CONSTANTS.TOTAL_STEPS && (
                    <ProgressBar currentStep={step} totalSteps={CONSTANTS.TOTAL_STEPS} />
                  )}
                  
                  <div ref={stepRef} tabIndex="-1" className="focus:outline-none">
                    {renderStep()}
                  </div>
                  
                  {step <= CONSTANTS.TOTAL_STEPS && (
                    <nav className="mt-8 flex justify-between" aria-label="è¡¨å–®å°èˆª">
                      <button 
                        onClick={handleBack} 
                        disabled={step === 1}
                        className="px-6 py-2 bg-stone-200 text-stone-700 rounded-lg font-semibold hover:bg-stone-300 disabled:bg-stone-100 disabled:text-stone-400 disabled:cursor-not-allowed transition-colors focus-enhanced"
                        aria-label="è¿”å›ä¸Šä¸€æ­¥"
                      >
                        â† ä¸Šä¸€æ­¥
                      </button>
                      <button 
                        onClick={handleNext}
                        disabled={step === 1 && !validation.isValid}
                        className="px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 disabled:bg-red-300 disabled:cursor-not-allowed transition-colors focus-enhanced"
                        aria-label={step === CONSTANTS.TOTAL_STEPS ? 'æŸ¥çœ‹è©•ä¼°å ±å‘Š' : 'å‰å¾€ä¸‹ä¸€æ­¥'}
                      >
                        {step === CONSTANTS.TOTAL_STEPS ? 'æŸ¥çœ‹è©•ä¼°å ±å‘Š â†’' : 'ä¸‹ä¸€æ­¥ â†’'}
                      </button>
                    </nav>
                  )}
                </main>
                
                <footer className="text-center mt-8 text-sm text-emerald-950 font-normal">
                  <p>&copy; {new Date().getFullYear()} éº»é†‰é¢¨éšªè©•ä¼°åŠ©æ‰‹. All Rights Reserved to Healthinvestor_</p>
                </footer>
              </div>
            </div>
          </ErrorBoundary>
        );
      }
      
      // === æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼ ===
      const container = document.getElementById('root');
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    </script>
</body>
</html>
